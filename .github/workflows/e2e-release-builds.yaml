name: E2E Test - Release Builds

on:
  release:
    types:
      - released

jobs:
  e2e-test-release-builds:
    # TODO: Run the tests for macos, windows, linux.
    # Linux - we will check only basic check of plugins, to see if it's not corrupted.
    # MacOS and Windows - check signing too, apart from basic checks.
    runs-on: macos-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v1

      - name: Set up Go 1.x
        uses: actions/setup-go@v2
        with:
          go-version: "1.16"
        id: go

      - name: E2E Test - Release Builds
        run: |
          GITHUB_REF="${{ github.ref }}"
          version=${GITHUB_REF/refs\/tags\//}
          ./test/release-build-test/check-release-build.sh ${version}
